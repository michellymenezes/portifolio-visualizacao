<!DOCTYPE html>
<html lang="en-us">
<head>
<meta charset="utf-8">
<meta name="description" content="">
<meta name="keywords" content="">
<meta name="author" content="">
<meta name="generator" content="Hugo 0.30.2" />
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="https://michellymenezes.github.io/portifolio-visualizacao/css/style.css" type="text/css">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Code+Pro:400,700" type="text/css">
<link rel="alternate" href="https://michellymenezes.github.io/index.xml" type="application/rss+xml" title="Portifólio Visualização">
<title>Fluxo na sociedade - Portifólio Visualização</title>
</head>
<body>

<header>
  <div class="container clearfix">
    <a class="path" href="https://michellymenezes.github.io/portifolio-visualizacao/">[Portifólio Visualização]</a>
    <span class="caret"># _</span>
    <div class="right">
      
    </div>
  </div>
</header>

<div class="container">


<main role="main" class="article">
  
<article class="single" itemscope itemtype="http://schema.org/BlogPosting">
  <div class="meta">

    <span class="key">published on</span>
    <span class="val"><time itemprop="datePublished" datetime="2017-12-05">December 05, 2017</time></span>



    <br>
    <span class="key">tags:</span>
    <span class="val">

        <a href="https://michellymenezes.github.io/portifolio-visualizacao/tags/d3">D3</a>

        <a href="https://michellymenezes.github.io/portifolio-visualizacao/tags/heatmap">Heatmap</a>

        <a href="https://michellymenezes.github.io/portifolio-visualizacao/tags/streamgraph">streamgraph</a>

        <a href="https://michellymenezes.github.io/portifolio-visualizacao/tags/barchart">barchart</a>

        <a href="https://michellymenezes.github.io/portifolio-visualizacao/tags/interactive">interactive</a>

    </span>

  </div>
  <h1 class="headline" itemprop="headline">Fluxo na sociedade</h1>
  <section class="body" itemprop="articleBody">
    <!DOCTYPE html>
<html lang="pt-br">

<head>
  <meta charset="utf-8">
  <title>Fluxo na sociedade</title>
  <script src="https://d3js.org/d3.v2.js"></script>

  <script src="https://d3js.org/d3.v4.min.js"></script>
</head>

<body>
  <div class="container">
    <div class="row">
      <h1>O que o fluxo e mobilidade pode nos contar sobre a sociedade?</h1>
      <p> O fluxo das pessoas e os meios que utilizam para se deslocar pode nos
        dizer muito a respeito de hábitos, estilo de vida e outras características
        de uma cidade.</p>
      <p>Em uma coleta realizada pela equipe do Lab Rua foi possível obter dados
      a respeito da circulação de pessoas ao longo do dia em três pontos consideravelmente
      movimentados na cidade de Campina Grande. Eles contabilizaram a quantidade de diferentes
      veículos e pedestres a cada 15 minutos, das 6h até as 20h de um dia, nos 3 pontos: monumento
      dos burrinhos, estátua de Jackson do pandeiro e Luiz Gonzaga e em frente ao Bobs.</p>
    </div>

    <h2>O transporte na cidade</h2>

    <p>Foram observados 6 diferentes meios de transporte fazendo parte do fluxo
      nesses pontos: carro, moto, onibus, caminhão, bicicleta e a caminhada comum.
      Podemos observar no gráfico abaixo a frequência contabilizada para cada horário
      do dia.</p>
    <p>Para cada hora do dia, para cada ponto de observação, foi somada a frquência
    de cada meio utilizado. Você pode clicar nas opções de lugares para observar a
    contagem separadamente ou selecionar a opção "todos", que é a mediana
    utilizando as somas de cada ponto e dá uma visão geral sobre o fluxo.</p>


    <div class="row mychart1" id="chart1">
      <div class="container">
        <div class="left">
          <h5>Selecionar local:</h5>
        </div>
        <div class="left">
          <div id="controls"></div >
        </div>
      </div>
      <div class="container">
        <div class="left">
          <h5>Ordenar por horário:</h5>
        </div>
        <div class="left">
          <div id="selectH"></div >
        </div>
      </div>
  </div>


    <div id="tooltip" class="hidden">
         <p id="titulo_tooltip"></p>
			   <p><b id="value">0</b></p>
		 </div>

    <h4>O que podemos entender sobre a opção "todos":</h4>
    <p><li type="disc">Carros, motos e pedestres são os mais frequentes. Em todos
    os momentos observados eles foram contabilizados no mínimo 70 aparições de
    cada um deles.</li></p>
    <p><li type="disc">Pedrestes são os únicos que chegam a ultrapassar a
    contagem de 800. Porém, diferente dos carros que não variam muito em números,
    estes apresentam picos no início e no fim do dia. </li></p>
    <p><li type="disc">Caminhões, ônibus e ciclistas apresentam uma menor frequência
    ao longo do dia, principalmente os dois primeiros. Ônibus e caminhões não
    chegam à marca de 50 observações em nenhum momento do dia.</li></p>
    <p><li type="disc">Ciclistas apresentam um comportamento semelhante ao dos
    pedestres com picos no início e fim do dia. Isso muito provavelmente descreve
    o momento que pessoas utilizam para a prática de exercícios ou ida/volta ao/do
    trabalho.</li></p>

    <h2>O ambiente na cidade</h2>

    <p>Sabe-se que veículos motorizados a partir da queima de combustível são um
    dos elementos que colaboram com a degradação do ambiente. Cidades em que as
    pessoas optam pelo uso de bicicletas, caminhada e outros meios não poluentes
    são vistas como mais sustentáveis.</p>
    <p>O gráfico abaixo faz o comparativo entre o uso de meios poluentes e não
    poluentes ao longo do dia. Assim como o anterior, este apresenta valores de
    medianas dos pontos de observação. Neste especificamente não houve soma,
     então os valores possuem um intervalo de 15 minutos.</p>

    <div class="chart2" id="chart2">
    </div>

    <p>Entendemos a partir desssa visualização que a quantidade de meios motorizados
      - a.k.a. poluentes - é sempre maior que de meios não motorizados. Isso faz
    com que possamos perceber que Campina Grande não é uma cidade exemplo no quesito
    preocupação com o meio ambiente.</p>
    <p> Apesar da primeira visualização destacar os pedestres, agora vemos
    que isso não é muito significativo quando dividimos nessas duas categorias.</p>

    <h2>A liberdade na cidade (?)</h2>
    <p>Observar horários e frequências das pessoas também pode nos contar um pouco
    sobre a segurança do lugar. Dentre os meios observados ciclistas e pedestres
    são os mais vulneráveis com relação a segurança, podemos analisar como homens
    e mulheres fazem uso do espaço público e tirar possíveis conclusões da maneira
    que se apresentam quanto a isso.</p>
    <p>A visualização abaixo mostra a contagem de homens e mulheres, sendo estes
    ciclistas e pedestres, para cada hora observada. A soma da presença de cada um
    dos grupos foi feita para cada hora em cada local de observação. O valor apresentado
    para cada grupo é a mediana dessas somas.</p>
    <p>Selecionar a visualização agrupada é melhor para ver e copamparar valores
    individualmente. A opção empilhada é mais aconselhada para ver os elementos
    como parte do todo.</p>

    <div>
    <form>
      <label><input type="radio" name="mode" value="grouped"> Agrupada</label>
      <label><input type="radio" name="mode" value="stacked" checked> Empilhada</label>
    </form>
    </div>
    <div class="chart3" id="chart3"></div>

    <h4>O que os dados mostram:</h4>
    <p><li type="disc">Em todos os horários a quantidade de homens é superior a
    quantidade de mulheres, com exceção as 7h. Esse é um fato tanto para pedestres
     quanto para ciclistas.</li></p>
    <p><li type="disc">A quantidade de homens e mulheres pedestres é bem pequena
    na primeira hora do dia. Essa diferença se torna maior e mais perceptível a
    medida que o dia passa.</li></p>
    <p><li type="disc">A presença de mulheres ciclistas é mínima, quase invisível.</li></p>

    <h4>Para refletir:</h4>
    <blockquote><p>É comum que os horários de caminhada como exercício físico ou
    idas e voltas do trabalho sejam no início ou no fim do dia, mas por que há
    uma diferença tão grande na quantidade de homens e mulheres nesses dois
    períodos? Uma possível explicação é que as mulheres não se sentem seguras o
    suficiente para andar livremente (principalmente) a noite, isso é um reflexo
    da violência em nossa socidade e da maior vulnerabilidade da mulher nesse quesito.</p>
    <p>Olhando por esse ponto de vista chegamos ao pensamento de que a liberdade
    individual das mulheres pode estar sendo afetada por conta da violência.</p>
    <p><BBB/p></blockquote>

    <p><i>Por: Martha Michelly G M</i></p>
  </div>

  <style>

  #tooltip {
  position: absolute;
  width: auto;
  height: auto;
  padding: 10px;
  background-color: #D3F6DB;
  border-radius: 10px;
}

#tooltip.hidden {
  display: none;
}

#tooltip p {
  margin: 0;
  font-family: sans-serif;
  font-size: 12px;
  line-height: 20px;
}

    .mychart1 rect.bordered {
      stroke: #E6E6E6;
      stroke-width:2px;
    }

    .mychart1 text {
      font-size: 9pt;
      font-family: Consolas, courier;
      fill: #818080;
    }

    .mychart1 text {
      fill: #818080;
    }

    .mychart1 text {
      fill: #818080;
    }


    .chart2 {
      font: 10px sans-serif;
      font-family: Consolas, courier;
    }

    .chart3 p {
      font: 12px helvetica;
      font-family: Consolas, courier;
    }

    .axis path, .axis line {
      fill: none;
      stroke: #818080;
      stroke-width: 2px;
      shape-rendering: crispEdges;
    }
    .chart3 form {
      font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
      position: absolute;
      left: 10px;
      top: 10px;
    }

    .chart3 label {
      display: block;
    }

    .chart3 text.mono {
      font-size: 8pt;
      font-family: Consolas, courier;
      fill: #818080;
    }

  </style>

  <script type="text/javascript">
    "use strict"

    var tipos = ["Pedestres", "Carros", "Motos", "Ciclistas", "Onibus", "Caminhoes"],
    horas = ["06", "07", "08", "09", 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20];

      function onlyUnique(value, index, self) {
          return self.indexOf(value) === index;
      }

      function tipoToNum(tipo) {
        return tipos.indexOf(tipo);
      }

      function ordenaTipos(h, dados, dimensao){
        console.log(tipos);
        tipos = dados
        .filter(e => e.hora == h && e.local == dimensao)
         .sort(function(a, b){return a.n - b.n})
         .map(e => e.tipo)
         .reverse()
        console.log(tipos);
      }

      function pickColor(colors, n, tipo){
    //    console.log(tipo, n);
    //    n = Math.floor(n/850*9);
        var k = 0;
        if(n >= 20) k += 1;
        if(n >= 50) k += 1;
        if(n >= 70) k += 1;
        if(n >= 100) k += 1;
        if(n >= 250) k += 1;
        if(n >= 400) k += 1;
        if(n >= 550) k += 1;
        if(n >= 800) k += 1;
        return colors[k]
      }
      // Preencha aqui.
      var alturaSVG = 400, larguraSVG = 600;
      var	margin = {top: 50, right: 40, bottom:100, left:80}, // para descolar a vis das bordas do grafico
          larguraVis = larguraSVG - margin.left - margin.right,
          alturaVis = alturaSVG - margin.top - margin.bottom,
          gridSize = Math.floor(larguraVis / 15),
          legendElementWidth = Math.floor(larguraVis / 9),
          buckets = 9,
          colors = ["#ffffd9","#edf8b1","#c7e9b4","#7fcdbb","#41b6c4","#1d91c0","#225ea8","#253494","#081d58"]; // alternatively colorbrewer.YlGnBu[9];

      /*
       * Prepara onde adicionaremos a visualizacao
       */

      var grafico = d3.select('#chart1') // cria elemento <svg> com um <g> dentro
        .append('svg')
        .attr('viewBox', '0 0 '+(larguraVis + margin.left + margin.right)+' '+(alturaVis + margin.top + margin.bottom))
        .attr('width', '100%')
        .append('g') // para entender o <g> vá em x03-detalhes-svg.html
          .attr('transform', 'translate(' +  margin.left + ',' + margin.top + ')');

      var grupoLabels = grafico.selectAll(".grupoLabel")
          .data(tipos)
          .enter().append("text")
            .text(function (d) { return d; })
            .attr("x", 0)
            .attr("y", function (d, i) { return i * gridSize; })
            .style("text-anchor", "end")
            .attr("transform", "translate(-6," + gridSize / 1.5 + ")")
            .attr("class", function (d, i) { return "grupoLabel mono axis axis-grupo"; });

      var timeLabels = grafico.selectAll(".timeLabel")
                .data(horas)
                .enter().append("text")
                  .text(function(d) { return d; })
                  .attr("x", function(d, i) { return i * gridSize; })
                  .attr("y", 0)
                  .style("text-anchor", "middle")
                  .attr("transform", "translate(" + gridSize / 2 + ", -6)")
                  .attr("class", function(d, i) { return "timeLabel mono axis"; });


      var heatmapChart = function() {
        d3.csv("https://raw.githubusercontent.com/michellymenezes/portifolio-visualizacao/master/data/tipos-fluxo-campina-lugares-sum-median.csv",

        function(error, dados) {
          // var colorScale = d3.scaleQuantile()
          //     .domain([0, buckets - 1, d3.max(dados, function (d) { return d.n; })])
          //     .range(colors);

          var dimensao = "todos"

          var colorScale = d3.scaleThreshold()
              .domain([0, 20, 50, 70, 100, 250, 400, 550, 800])
              .range([0].concat(colors));

          var cards = grafico.selectAll("rect")
              .data(dados.filter(d => d.local == "todos"));
          ordenaTipos("06", dados, dimensao);


      //    cards.append("title");

          cards = cards.enter().append("rect")
              .attr("x", function(d) { return (d.hora - 6) * gridSize; })
              .attr("y", function(d) { return (tipoToNum(d.tipo)) * gridSize; })
              .attr("rx", 4)
              .attr("ry", 4)
              .attr("class", "hour bordered")
              .attr("width", gridSize)
              .attr("height", gridSize)
              .style("fill", function(d) { return pickColor(colors, d.n, d.tipo)});

          /*
           * Eventos
           */
          grafico.selectAll(".hour").on("mouseover", mouseDentro);

          function mouseDentro(d){

            d3.selectAll(".hour")
             .style("fill",
                     p => (p.hora === d.hora && p.tipo === d.tipo)? "#fdae61" : d => pickColor(colors, d.hora, d.tipo));

            d3.select("#tooltip") // reparou que tem uma div escondida no html?
  						.style("left", (d3.event.pageX - 50) + "px")
  						.style("top", d3.event.pageY + "px")
  						.select("#value")
  						.text(d.n);

             d3.select("#tooltip #titulo_tooltip")
               .text(`${d.tipo} - ${dimensao}`);
  					// Mostra o tooltip
  					d3.select("#tooltip").classed("hidden", false);
          }

          grafico.selectAll(".hour").on("mouseout", mouseSaiu);
          function mouseSaiu(d){
            d3.selectAll(".hour")
             .style("fill",function(d) { return pickColor(colors, d.n, d.tipo)});

            d3.select("#tooltip").classed("hidden", true);

          }

          const dataKeys = ["todos", "bobs", "burrinhos", "jackson"]

          d3.select("#controls").selectAll("button.teams")
            .data(dataKeys)
            .enter()
              .append("button")
              .attr("class", "btn-default")
               .on("click", mudaDimensao)
               .html(d => d);


         function mudaDimensao(dimensaoSelecionada) {
           dimensao = dimensaoSelecionada;
           var dadosFiltrados = dados.filter(d => d.local === dimensaoSelecionada);

           cards = grafico.selectAll(".hour")
            .data(dadosFiltrados)
            .transition().duration(100).delay((d,i) => i * 10)
          //  .style("fill",function(d) { return pickColor(colors, d.n, d.tipo)});

            odernaPorHora()

         }

         d3.select("#selectH")
         .append('select')
         .attr('class','select')
          .on("change", odernaPorHora)
          .selectAll('option')
          .data(horas).enter()
           .append('option')
             .text(function (d) { return d; });

         function odernaPorHora() {
           var h = d3.select('select').property('value');
           ordenaTipos(h, dados, dimensao);

           grupoLabels = grafico.selectAll(".grupoLabel")
               .data(tipos)
                 .text(function (d) { return d; })
                 .attr("x", 0)
                 .attr("y", function (d, i) { return i * gridSize; })


           cards = grafico.selectAll(".hour")
           .transition().duration(100).delay((d,i) => i * 10)
               .attr("x", function(d) { return (d.hora - 6) * gridSize; })
               .attr("y", function(d) { return (tipoToNum(d.tipo)) * gridSize; })
               .style("fill",function(d) { return pickColor(colors, d.n, d.tipo)})


         }

          var legend = grafico.selectAll(".legend")
              .data(colorScale.domain(), function(d) { return d; })
              .enter().append("g")
              .attr("class", "legend");

          legend.append("rect")
            .attr("x", function(d, i) { return legendElementWidth * i; })
            .attr("y", alturaVis)
            .attr("width", legendElementWidth)
            .attr("height", gridSize / 2)
            .style("fill", function(d, i) { return colors[i]; });

          legend.append("text")
            .attr("class", "mono")
            .text(function(d) { return "≥ " + Math.round(d); })
            .attr("x", function(d, i) { return legendElementWidth * i; })
            .attr("y", alturaVis + gridSize);
        });
      };

      heatmapChart();








      chart("https://raw.githubusercontent.com/michellymenezes/portifolio-visualizacao/master/data/tipos-motor-fluxo-campina-median0.csv", "orange");

      var datearray = [];
      var colorrange = [];


      function chart(csvpath, color) {

        if (color == "blue") {
          colorrange = ["#045A8D", "#2B8CBE", "#74A9CF", "#A6BDDB", "#D0D1E6", "#F1EEF6"];
        }
        else if (color == "pink") {
          colorrange = ["#980043", "#DD1C77", "#DF65B0", "#C994C7", "#D4B9DA", "#F1EEF6"];
        }
        else if (color == "orange") {
          colorrange = ["#d7191c", "#fdae61", "#FC8D59", "#FDBB84", "#FDD49E", "#FEF0D9"];
        }
        var strokecolor = colorrange[0];

        var format = d3.time.format("%H:%M");

        var margin = {top: 50, right: 40, bottom: 100, left: 30};
        //var width = 600- margin.left - margin.right;
        //var height = 300 - margin.top - margin.bottom;
        var width = 600 - margin.left - margin.right;;
        var height = alturaSVG - margin.top - margin.bottom;;

        var tooltip = d3.select(".chart2")
            .append("div")
            .attr("class", "remove")
            .style("position", "absolute")
            .style("z-index", "20")
            .style("visibility", "hidden")
            .style("top", height*4 + "px")
            .style("left", width + "px");

        var x = d3.time.scale()
            .range([0, width]);

        var y = d3.scale.linear()
            .range([height-10, 0]);

        var z = d3.scale.ordinal()
            .range(colorrange);

        var xAxis = d3.svg.axis()
            .scale(x)
            .orient("bottom")
            .ticks(d3.time.hours);
        var yAxis = d3.svg.axis()
            .scale(y);

        var yAxisr = d3.svg.axis()
            .scale(y);

        var stack = d3.layout.stack()
            .offset("silhouette")
            .values(function(d) { return d.values; })
            .x(function(d) { return d.date; })
            .y(function(d) { return d.value; });

        var nest = d3.nest()
            .key(function(d) { return d.key; });

        var area = d3.svg.area()
            .interpolate("cardinal")
            .x(function(d) { return x(d.date); })
            .y0(function(d) { return y(d.y0); })
            .y1(function(d) { return y(d.y0 + d.y); });

        var svg = d3.select(".chart2").append("svg")
        .attr('viewBox', '0 0 '+(width + margin.left + margin.right)+' '+(height + margin.top + margin.bottom))
        .attr('width', '100%')
          .append("g")
            .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

        var graph = d3.csv(csvpath, function(data) {
          data.forEach(function(d) {
            d.date = format.parse(d.date);
            d.value = +d.value;
          });

          var layers = stack(nest.entries(data));

          x.domain(d3.extent(data, function(d) { return d.date; }));
          y.domain([0, d3.max(data, function(d) { return d.y0 + d.y; })]);

          svg.selectAll(".layer")
              .data(layers)
              .enter().append("path")
              .attr("class", "layer")
              .attr("d", function(d) { return area(d.values); })
              .style("fill", function(d, i) { return z(i); });
            var  formatTime = d3.time.format("%H:%M")

          svg.append("g")
              .attr("class", "x axis")
              .attr("transform", "translate(0, " + height + ")")
              .call(d3.axisBottom(
                d3.scaleLinear()
                  .domain([6, 20.75])
                  .rangeRound([0, width]) // Configure essa escala com domain, range e padding

              ));

          svg.append("g")
              .attr("class", "y axis")
              .attr("transform", "translate(" + width + ", 0)")
              .call(d3.axisRight(
                d3.scaleLinear()
                  .domain([305, 0])
                  .rangeRound([0, height]) // Configure essa escala com domain, range e padding

              ));

          svg.append("g")
              .attr("class", "y axis")
              .call(d3.axisLeft(
                d3.scaleLinear()
                  .domain([305, 0])
                  .rangeRound([0, height]) // Configure essa escala com domain, range e padding

              ));


          var legendElementWidth = Math.floor(((width - margin.left) / 2)),
          gridSize = Math.floor(width / 15);


          var colorScale = d3.scaleThreshold()
              .domain(["Não motorizados", "Motorizados"])
              .range([0].concat(colors));


          var legend = svg.selectAll(".legend")
              .data(colorScale.domain(), function(d) { return d; })
              .enter().append("g")
              .attr("class", "legend");

          var colorrange = ["#d7191c", "#fdae61", "#FC8D59", "#FDBB84", "#FDD49E", "#FEF0D9"];

          legend.append("rect")
            .attr("x", function(d, i) { return (legendElementWidth * i) + margin.left; })
            .attr("y", height + 30)
            .attr("width", legendElementWidth)
            .attr("height", gridSize / 2)
            .style("fill", function(d, i) { return colorrange[i]});

          legend.append("text")
            .attr("class", "mono")
            .text(function(d) { return d; })
            .attr("x", function(d, i) { return (legendElementWidth * i)+ margin.left; })
            .attr("y", height + 70);
  //var pro = 0
          svg.selectAll(".layer")
            .attr("opacity", 1)
            .on("mouseover", function(d, i) {
              svg.selectAll(".layer").transition()
              .duration(250)
              .attr("opacity", function(d, j) {
                return j != i ? 0.6 : 1;
            })})

        //     .on("mousemove", function(d, i) {
        //       var mousex = d3.mouse(this);
        //       mousex = mousex[0];
        //       var invertedx = [x.invert(mousex)].map(formatTime)[0];
        // //      console.log(invertedx);
        // //      invertedx = invertedx.getTime();
        //       if(invertedx.substring(3,5) == "00" || invertedx.substring(3,5) == "15" || invertedx.substring(3,5) == "30" || invertedx.substring(3,5) == "45"){
        //       var selected = (d.values);
        //       for (var k = 0; k < selected.length; k++) {
        //
        //     //  );
        //         datearray[k] = [selected[k].date].map(formatTime)[0]
        //       }
        //       var mousedate = datearray.indexOf(invertedx);
        //
        //
        //       pro = d.values[mousedate].value;
        //
        //       d3.select(this)
        //       .classed("hover", true)
        //       .attr("stroke", strokecolor)
        //       .attr("stroke-width", "0.5px"),
        //       tooltip.html( "<p>" + d.key + "<br>" + pro + "</p>" ).style("visibility", "visible");
        // }
        //     })
             .on("mouseout", function(d, i) {
              svg.selectAll(".layer")
               .transition()
               .duration(250)
               .attr("opacity", "1");
        //       d3.select(this)
        //       .classed("hover", false)
        //       .attr("stroke-width", "0px"), tooltip.html( "<p>" + d.key + "<br>" + pro + "</p>" ).style("visibility", "hidden");
           })
      //    console.log(height);
          // var vertical = d3.select(".chart2")
          //       .append("div")
          //       .attr("class", "remove")
          //       .style("position", "absolute")
          //       .style("z-index", "19")
          //       .style("width", "1px")
          //       .style("height", height+"px")
          //       .style("top", height * 4 + "px")
          //       .style("bottom", -alturaSVG + "px")
          //       .style("right", width  +  "px")
          //       .style("background", "#fff");
          //
          // d3.select(".chart2")
          //     .on("mousemove", function(){
          //        var mousex = d3.mouse(this);
          //        mousex = mousex[0] + 5;
          //        vertical.style("left", mousex + width/2 + margin.right*2 + margin.left - 5  + "px" )})
          //     .on("mouseover", function(){
          //       var mousex = d3.mouse(this);
          //        mousex = mousex[0] + 5;
          //        vertical.style("left", mousex + width/2 + margin.right*2 + margin.left - 5 + "px" )})
        });
      }





      barchart();

      function barchart() {
        d3.csv("https://raw.githubusercontent.com/michellymenezes/portifolio-visualizacao/master/data/fluxo-homens-mulheres-median.csv",

        function(error, dados) {

          var n = 4, // The number of series.
              m = 15, // The number of values per series.
              mm = [6,7,8,9,10,11,12,13,14,15,16,17,18,19,20]

          function associaTipoN(n) {
              return dados.filter(e => e == n)
          }
          var tipos = ["homens_ciclistas", "mulheres_ciclistas", "homens_pedestres", "mulheres_pedestres"]
          //    var tipos = [0, 1, 2, 3]

          // The xz array has m elements, representing the x-values shared by all series.
          // The yz array has n elements, representing the y-values of each of the n series.
          // Each yz[i] is an array of m non-negative numbers representing a y-value for xz[i].
          // The y01z array has the same structure as yz, but with stacked [y₀, y₁] instead of y.
          var xz = mm,
              yz = d3.range(n).map(function(e) { return bumps(tipos[e], dados); }),
              y01z = d3.stack().keys(d3.range(n))(d3.transpose(yz)),
              yMax = d3.max(yz, function(y) { return d3.max(y); }),
              y1Max = d3.max(y01z, function(y) { return d3.max(y, function(d) { return d[1]; }); });

            //  console.log(y01z);

          var svg = d3.select("#chart3").append('svg'),
              margin = {top: 50, right: 30, bottom: 100, left: 20},
              width = 550 - margin.left  - margin.right,
              height = alturaSVG - margin.top - margin.bottom,
              g = svg
              .attr('viewBox', '0 0 '+(width + margin.left + margin.right)+' '+(height + margin.top + margin.bottom))
              .attr('width', '100%')
              .append("g").attr("transform", "translate(" + margin.left + "," + margin.top + ")");

              var x = d3.scaleBand()
                  .domain(mm)
                  .rangeRound([margin.left, width])
                  .padding(0.08);

              var y = d3.scaleLinear()
                  .domain([0, y1Max])
                  .range([height, 0]);

              var colors = ["#d7191c", "#fdae61", "#2b83ba", "#abdda4"]


              var color = d3.scaleOrdinal()
                  .domain(d3.range(n))
                  .range(colors);

              var series = g.selectAll(".series")
                .data(y01z)
                .enter().append("g")
                  .attr("fill", function(d, i) { return color(i); });

              var rect = series.selectAll("rect")
                .data(function(d) { return d; })
                .enter().append("rect")
                  .attr("x", function(d, i) { return x(i); })
                  .attr("y", height)
                  .attr("width", x.bandwidth())
                  .attr("height", 0);

              rect.transition()
                  .delay(function(d, i) { return i * 10; })
                  .attr("y", function(d) { return y(d[1]); })
                  .attr("height", function(d) { return y(d[0]) - y(d[1]); });

              g.append("g")
                  .attr("class", "axis axis--x")
                  .attr("transform", "translate(0," + height + ")")
                  .call(d3.axisBottom(x)
                      .tickSize(0)
                      .tickPadding(6));

              g.append("g")
                  .attr("class", "axis axis--y")
                  .attr("transform", "translate(" + width +  ", 0)")
                  .call(d3.axisRight(y)
                      .tickSize(0)
                      .tickPadding(6));

              g.append("g")
                  .attr("class", "axis axis--y")
                  .attr("transform", "translate(" + margin.left +  ", 0)")
                  .call(d3.axisLeft(y)
                      .tickSize(0)
                      .tickPadding(6));


              d3.selectAll("input")
                  .on("change", changed);

              var timeout = d3.timeout(function() {
                d3.select("input[value=\"grouped\"]")
                    .property("checked", true)
                    .dispatch("change");
              }, 2000);

              function changed() {
                timeout.stop();
                if (this.value === "grouped") transitionGrouped();
                else transitionStacked();
              }

              function transitionGrouped() {
                y.domain([0, yMax]);

                rect.transition()
                    .duration(500)
                    .delay(function(d, i) { return i * 10; })
                    .attr("x", function(d, i) { return x(i) + x.bandwidth() / n * this.parentNode.__data__.key; })
                    .attr("width", x.bandwidth() / n)
                  .transition()
                    .attr("y", function(d) { return y(d[1] - d[0]); })
                    .attr("height", function(d) { return y(0) - y(d[1] - d[0]); });
              }

              function transitionStacked() {
                y.domain([0, y1Max]);

                rect.transition()
                    .duration(500)
                    .delay(function(d, i) { return i * 10; })
                    .attr("y", function(d) { return y(d[1]); })
                    .attr("height", function(d) { return y(d[0]) - y(d[1]); })
                  .transition()
                    .attr("x", function(d, i) { return x(i); })
                    .attr("width", x.bandwidth());
              }
              var legendElementWidth = Math.floor(((width - margin.left) / 4)),
              gridSize = Math.floor(width / 15);


              var colorScale = d3.scaleThreshold()
                  .domain(["Homens ciclistas", "Mulheres ciclistas", "Homens Pedestres", "Mulheres Pedestres"])
                  .range([0].concat(colors));


              var legend = g.selectAll(".legend")
                  .data(colorScale.domain(), function(d) { return d; })
                  .enter().append("g")
                  .attr("class", "legend");

              var colors = ["#d7191c", "#fdae61", "#2b83ba", "#abdda4"]

              legend.append("rect")
                .attr("x", function(d, i) { return (legendElementWidth * i) + margin.left; })
                .attr("y", height + 30)
                .attr("width", legendElementWidth)
                .attr("height", gridSize / 2)
                .style("fill", function(d,i){return colors[i]});

              legend.append("text")
                .attr("class", "mono")
                .text(function(d) { return d; })
                .attr("x", function(d, i) { return (legendElementWidth * i)+ margin.left; })
                .attr("y", height + 70);



          // Returns an array of m psuedorandom, smoothly-varying non-negative numbers.
          // Inspired by Lee Byron’s test data generator.
          // http://leebyron.com/streamgraph/
          function bumps(m, dados) {
            var values = [], i, j, w, x, y, z;
            var n = 6;
            // Initialize with uniform random values in [0.1, 0.2).
            for (i = 0; i < dados.length; ++i) {
              if(dados[i].tipo == m){
                values[n] = Number(dados[i].n);
                n = n +1;
              }
            }

            return values;
          }
      })}



  </script>
</body>

</html>

  </section>
</article>

</main>


</div>

<footer>
  <div class="container">
    <span class="copyright">&copy; 2017  Portifólio Visualização - <a rel="license" href="http://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a></span>
  </div>
</footer>

</body>
</html>

